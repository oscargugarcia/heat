% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/r2e2.R
\name{r2e2}
\alias{r2e2}
\title{Run the Climate Data Pipeline}
\usage{
r2e2(
  env_rast,
  polygons,
  poly_id_col = NULL,
  trans_type,
  trans_args,
  temp_agg_args,
  sec_weight_rast = NULL,
  boundary_dates = NULL,
  spatial_agg_args = NULL,
  save_path = NULL,
  out_format = "all",
  run_control_checks = TRUE,
  max_cells = 3e+07,
  metadata = NULL,
  save_console_output = FALSE,
  save_batch_output = TRUE,
  overwrite_batch_output = FALSE,
  compression = "zstd",
  control_checks_rmd = "02_control_checks_source_template.Rmd",
  selected_trans_var = "degree_1",
  trans_var_description = "Temperature (C°)"
)
}
\arguments{
\item{env_rast}{Either a character string specifying the directory path to environmental
rasters, OR a SpatRaster object containing the environmental data.
Layer names must be in date format (e.g., "YYYY-MM-DD").}

\item{polygons}{Either a character string specifying the file path to a spatial polygon file
(e.g., shapefile, geopackage), OR an sf/SpatVector object containing the
polygons for spatial aggregation.}

\item{poly_id_col}{A character string representing the column name of the unique ID
in the polygon dataset (e.g., "GEOID"). If NULL, a row_index
column will be created and used as the polygon ID,
and all other columns are kept in the output.}

\item{trans_type}{A character string indicating the type of transformation to apply
to the raster data (e.g., "polynomial", "bin", etc.).}

\item{trans_args}{A list of additional parameters to be passed to the transformation
function (e.g., polynomial degree).}

\item{temp_agg_args}{A list containing parameters for temporal aggregation, including
the output temporal resolution (out_temp_res) and aggregation function.}

\item{sec_weight_rast}{Either a character string specifying the directory path to secondary
weight rasters, OR a SpatRaster object containing the weight data.
If NULL (default), no secondary weighting is applied.
Layer names must be in date format.}

\item{boundary_dates}{A vector of Date objects defining the start and end dates for
the weighting periods.}

\item{spatial_agg_args}{A list containing any specific arguments related to spatial
aggregation, including optional append_cols for additional columns
to include in output (default is NULL).}

\item{save_path}{Optional character string specifying the output directory for storing
results. If NULL (default), results will be returned without saving to disk.
When provided, area weights are automatically saved.}

\item{out_format}{Character string specifying the output format. Options are:
- "all" (default): Returns and saves both wide and long formats
- "wide": Returns and saves only wide format (time steps as columns)
- "long": Returns and saves only long format (time steps as rows)
Wide format has one row per polygon with time steps as separate columns.
Long format has one row per polygon-time combination with time in rows.}

\item{run_control_checks}{A logical value indicating whether to generate control check
reports for data validation (default is TRUE).}

\item{max_cells}{A numeric value representing the maximum number of raster cells that
can be processed at once (default is 3e7).}

\item{metadata}{A list containing metadata related to the dataset and analysis,
such as variable names, descriptions, and additional identifiers (default is NULL).}

\item{save_console_output}{A logical value indicating whether to save console output
to a log file (default is FALSE).}

\item{save_batch_output}{Logical indicating whether to save intermediate batch outputs to disk for memory efficiency (default: TRUE).}

\item{overwrite_batch_output}{Logical indicating whether to overwrite existing batch files. When FALSE, existing files
are validated to ensure layer counts match current processing parameters (default: FALSE).}

\item{compression}{A character string specifying the compression algorithm for parquet
files (default is 'zstd').}

\item{control_checks_rmd}{A character string specifying the name of the RMD template
file to look for in the utils folder (default is "02_control_checks_source_template.Rmd")}

\item{selected_trans_var}{The name of the transformation variable to be used in the report.
(default is 'degree_1' but if not found, it will use the first detected transformation variable)}

\item{trans_var_description}{A character string describing the transformation variable
for plot labels (default is "Temperature (C°)")}
}
\value{
A list containing the processed data frames:
- spatial_agg: Daily aggregated data in wide format (time steps as columns, NULL if out_format = "long")
- spatial_agg_long: Daily aggregated data in long format (time steps as rows, NULL if out_format = "wide" or temporal resolution is daily)
- temp_agg_wide: Temporally aggregated data in wide format (time steps as columns, NULL if out_format = "long" or temporal resolution is daily)
- temp_agg_long: Temporally aggregated data in long format (time steps as rows, NULL if out_format = "wide")
- area_weights: Area weights data frame (always included)
Results are also saved directly to the specified output directory in parquet format when save_path is provided.
}
\description{
This function runs an aggregation pipeline that processes environmental raster data
and polygon datasets to perform spatial and temporal aggregations. It loads the necessary
data, applies specified transformations, and outputs aggregated results in both wide
and long formats. The function also allows for the calculation of area weights if
specified.
}
\details{
The function performs the following main operations:
\itemize{
\item Loads spatial and environmental data.
\item Processes and applies transformations to raster data.
\item Executes spatial and temporal aggregations with optional secondary weighting.
\item Saves the results in both wide and long formats along with optional area weights.
}
}
