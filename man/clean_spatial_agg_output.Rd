% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aggregation.R
\name{clean_spatial_agg_output}
\alias{clean_spatial_agg_output}
\title{Clean Spatial Aggregation Output and Reattach Appended Columns}
\usage{
clean_spatial_agg_output(
  extraction_result,
  time_steps,
  polygons,
  polygon_id_col
)
}
\arguments{
\item{extraction_result}{A data.frame or data.table produced by exact_extract containing only the
aggregated columns}

\item{time_steps}{A vector of dates (or character representations) corresponding to the time steps
present in the environmental raster subset.}

\item{polygon_id_col}{A string specifying the column in the polygons object containing the polygon ID.}
}
\value{
A data.table with columns: poly_id, , trans_var, and one
column per time step (named by the corresponding time step). Each row represents a polygon and a transformation
variable.
}
\description{
This function reshapes the raw spatial aggregation results from \code{exact_extract} into a long-format
data.table with one row per polygon and transformation variable. It performs the following steps:
\enumerate{
\item Converts the extraction result to a data.table.
\item Infers the number of time steps from the supplied \code{time_steps} vector.
\item Determines the number of transformation variables (\code{n_trans}) as the number of aggregated columns
divided by the number of time steps; if this is not a whole number, an error is raised.
\item Splits the remaining aggregated columns into blocks (one block per transformation variable),
renames these columns using the \code{time_steps}, and adds the polygon identifier and a transformation
variable indicator.
\item Combines the results from all blocks
}
}
\examples{
\dontrun{
  # Suppose spatial_agg_raw is the result of exact_extract, time_steps is a vector of dates, and 
  # polygons have an identifier in "poly_id". If spatial_agg_args$append_cols is provided, those columns 
  # will be reattached.
  cleaned_DT <- clean_spatial_agg_output(spatial_agg_raw, env_rast_time_steps, "poly_id")
}
}
